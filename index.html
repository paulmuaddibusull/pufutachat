<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pufuta Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #1e1e24; color: white; display: flex; justify-content: center; padding: 20px; }
        .chat-box { width: 100%; max-width: 500px; background: #2d2d37; border-radius: 15px; display: flex; flex-direction: column; height: 80vh; overflow: hidden; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { background: #3e3e4a; padding: 10px; border-radius: 10px; width: fit-content; }
        .user { color: #a29bfe; font-size: 0.8em; font-weight: bold; }
        .inputs { padding: 20px; background: #25252e; display: flex; flex-direction: column; gap: 10px; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #444; background: #1e1e24; color: white; }
        button { padding: 12px; border: none; border-radius: 8px; background: #a29bfe; color: #1e1e24; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="chat-box">
    <div id="messages">Memuat pesan...</div>
    <div class="inputs">
        <input type="text" id="username" placeholder="Nama kamu...">
        <input type="text" id="content" placeholder="Ketik pesan...">
        <button id="btnKirim">Kirim</button>
    </div>
</div>

<script>
    // 1. MASUKKAN DATA KAMU DI SINI
    const URL = "https://unyhtmyuvlkhfmwntgtq.supabase.co";
    const KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVueWh0bXl1dmxraGZtd250Z3RxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5NzI2NDcsImV4cCI6MjA4NjU0ODY0N30.ChTXmZ6EPDNqno9AN3kzFRiktcWR5ZyEIe68qYheEZ4";

    // 2. Inisialisasi (Cara yang paling pasti jalan)
    const supabase = window.supabase.createClient(URL, KEY);

    const msgDiv = document.getElementById('messages');
    const userInp = document.getElementById('username');
    const contInp = document.getElementById('content');
    const btn = document.getElementById('btnKirim');

    // 3. Fungsi Tampil Pesan
    function tampilkan(data) {
        const d = document.createElement('div');
        d.className = 'msg';
        d.innerHTML = `<div class="user">${data.username}</div><div>${data.content}</div>`;
        msgDiv.appendChild(d);
        msgDiv.scrollTop = msgDiv.scrollHeight;
    }

    // 4. Ambil Data Awal
    async function ambilPesan() {
        const { data, error } = await supabase.from('messages').select('*').order('id', { ascending: true });
        if (error) {
            msgDiv.innerHTML = "Error: " + error.message;
        } else {
            msgDiv.innerHTML = "";
            data.forEach(tampilkan);
        }
    }

    // 5. Fungsi Kirim
    async function kirim() {
        const u = userInp.value.trim();
        const c = contInp.value.trim();
        if (!u || !c) return alert("Isi nama dan pesan!");

        const { error } = await supabase.from('messages').insert([{ username: u, content: c }]);
        if (error) alert("Gagal: " + error.message);
        else contInp.value = "";
    }

    // 6. Realtime (Biar langsung muncul)
    supabase.channel('room1').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
        tampilkan(payload.new);
    }).subscribe();

    btn.onclick = kirim;
    ambilPesan();
</script>

</body>
</html>
